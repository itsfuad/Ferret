module Ferret/test_file_io

fn main() -> void {
  block b1 entry:
    %t1 = const str test_output.txt
    %t2 = const str Hello from Ferret!
    %t3 = call fs::WriteFile(%t1, %t2) : str ! bool
    %t4 = result_is_ok %t3
    br_if %t4, b2, b3
  block b2 result.ok:
    %t5 = result_unwrap bool %t3
    %t18 = const i64 20
    %t19 = const i32 1
    %t20 = call ferret_array_new(%t18, %t19) : []Printable
    %t21 = const str Write completed
    %t22 = alloca union {i8, i16, i32, i64, u8, u16, u32, u64, f32, f64, str, byte, bool}
    %t23 = ptr_add i32 %t22, 0
    %t24 = const i32 10
    store %t23, %t24
    %t25 = ptr_add str %t22, 4
    store %t25, %t21
    call ferret_array_append(%t20, %t22) : bool
    call io::Println(%t20) : void
    %t26 = alloca str
    %t27 = const str test_output.txt
    %t28 = call fs::ReadFile(%t27) : str ! str
    %t29 = result_is_ok %t28
    br_if %t29, b4, b5
  block b3 result.err:
    %t6 = result_unwrap str %t3
    %t7 = alloca str
    store %t7, %t6
    %t8 = const i64 20
    %t9 = const i32 1
    %t10 = call ferret_array_new(%t8, %t9) : []Printable
    %t11 = const str Write Error: 
    %t12 = load str %t7
    %t13 = call ferret_io_ConcatStrings(%t11, %t12) : str
    %t14 = alloca union {i8, i16, i32, i64, u8, u16, u32, u64, f32, f64, str, byte, bool}
    %t15 = ptr_add i32 %t14, 0
    %t16 = const i32 10
    store %t15, %t16
    %t17 = ptr_add str %t14, 4
    store %t17, %t13
    call ferret_array_append(%t10, %t14) : bool
    call io::Println(%t10) : void
    ret
  block b4 result.ok:
    %t30 = result_unwrap str %t28
    store %t26, %t30
    %t43 = const i64 20
    %t44 = const i32 1
    %t45 = call ferret_array_new(%t43, %t44) : []Printable
    %t46 = const str Content: 
    %t47 = load str %t26
    %t48 = call ferret_io_ConcatStrings(%t46, %t47) : str
    %t49 = alloca union {i8, i16, i32, i64, u8, u16, u32, u64, f32, f64, str, byte, bool}
    %t50 = ptr_add i32 %t49, 0
    %t51 = const i32 10
    store %t50, %t51
    %t52 = ptr_add str %t49, 4
    store %t52, %t48
    call ferret_array_append(%t45, %t49) : bool
    call io::Println(%t45) : void
    %t53 = const str test_output.txt
    %t54 = call fs::Remove(%t53) : str ! bool
    %t55 = result_is_ok %t54
    br_if %t55, b6, b7
  block b5 result.err:
    %t31 = result_unwrap str %t28
    %t32 = alloca str
    store %t32, %t31
    %t33 = const i64 20
    %t34 = const i32 1
    %t35 = call ferret_array_new(%t33, %t34) : []Printable
    %t36 = const str Read Error: 
    %t37 = load str %t32
    %t38 = call ferret_io_ConcatStrings(%t36, %t37) : str
    %t39 = alloca union {i8, i16, i32, i64, u8, u16, u32, u64, f32, f64, str, byte, bool}
    %t40 = ptr_add i32 %t39, 0
    %t41 = const i32 10
    store %t40, %t41
    %t42 = ptr_add str %t39, 4
    store %t42, %t38
    call ferret_array_append(%t35, %t39) : bool
    call io::Println(%t35) : void
    ret
  block b6 result.ok:
    %t56 = result_unwrap bool %t54
    %t69 = const i64 20
    %t70 = const i32 1
    %t71 = call ferret_array_new(%t69, %t70) : []Printable
    %t72 = const str Cleanup done
    %t73 = alloca union {i8, i16, i32, i64, u8, u16, u32, u64, f32, f64, str, byte, bool}
    %t74 = ptr_add i32 %t73, 0
    %t75 = const i32 10
    store %t74, %t75
    %t76 = ptr_add str %t73, 4
    store %t76, %t72
    call ferret_array_append(%t71, %t73) : bool
    call io::Println(%t71) : void
    ret
  block b7 result.err:
    %t57 = result_unwrap str %t54
    %t58 = alloca str
    store %t58, %t57
    %t59 = const i64 20
    %t60 = const i32 1
    %t61 = call ferret_array_new(%t59, %t60) : []Printable
    %t62 = const str Remove Error: 
    %t63 = load str %t58
    %t64 = call ferret_io_ConcatStrings(%t62, %t63) : str
    %t65 = alloca union {i8, i16, i32, i64, u8, u16, u32, u64, f32, f64, str, byte, bool}
    %t66 = ptr_add i32 %t65, 0
    %t67 = const i32 10
    store %t66, %t67
    %t68 = ptr_add str %t65, 4
    store %t68, %t64
    call ferret_array_append(%t61, %t65) : bool
    call io::Println(%t61) : void
    ret
}
