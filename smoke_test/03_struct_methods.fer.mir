module smoke_test/03_struct_methods

fn Counter_inc(receiver c: &Counter) -> void {
  block b1 entry:
    %t2 = alloca &Counter
    store %t2, %t1
    %t3 = load &Counter %t2
    %t4 = ptr_add i32 %t3, 0
    %t5 = load i32 %t4
    %t6 = const i32 1
    %t7 = + i32 %t5, %t6
    store %t4, %t7
    ret
}

fn Counter_get(receiver c: &Counter) -> i32 {
  block b2 entry:
    %t9 = alloca Counter
    store %t9, %t8
    %t10 = ptr_add i32 %t9, 0
    %t11 = load i32 %t10
    ret %t11
}

fn main() -> void {
  block b3 entry:
    %t12 = alloca Counter
    %t13 = alloca Counter
    %t14 = const i32 0
    %t15 = ptr_add i32 %t13, 0
    store %t15, %t14
    %t16 = const u64 4
    call ferret_memcpy(%t12, %t13, %t16) : void
    call Counter_inc(%t12) : void
    call Counter_inc(%t12) : void
    %t17 = const i64 20
    %t18 = const i32 1
    %t19 = call ferret_array_new(%t17, %t18) : []Printable
    %t20 = alloca Counter
    %t21 = const u64 4
    call ferret_memcpy(%t20, %t12, %t21) : void
    %t22 = call Counter_get(%t20) : i32
    %t23 = alloca union {i8, i16, i32, i64, u8, u16, u32, u64, f32, f64, str, byte, bool}
    %t24 = ptr_add i32 %t23, 0
    %t25 = const i32 2
    store %t24, %t25
    %t26 = ptr_add i32 %t23, 4
    store %t26, %t22
    call ferret_array_append(%t19, %t23) : bool
    call io::Println(%t19) : void
    ret
}
